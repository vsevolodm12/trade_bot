# Trade Bot — Progress

## Инфраструктура
- [x] Telegram бот (`bot/`) — мониторинг цен, уведомления
- [x] FastAPI веб-приложение (`web/`) — мобильный интерфейс
- [x] SQLite БД (`bot.db`) — shared между ботом и вебом (WAL)
- [x] Скрипты запуска: `start.sh`, `stop.sh`, `restart.sh`
- [x] Логирование в `logs/bot.log` и `logs/web.log`

## Источники данных
- [x] MOEX ISS — российские акции, бесплатно, без лимитов
- [x] TwelveData — иностранные акции, 800 кредитов/день, батч раз в 3ч
- [x] Yahoo Finance (yfinance) — непрерывный мониторинг US/HK, бесплатно
- [x] Yahoo Finance — курсы валют (USDRUB, HKDUSD), кеш 1ч (`bot/services/forex.py`)

## Мониторинг цен
- [x] Цены обновляются каждые 30 сек **всегда** (даже при закрытом рынке)
- [x] Telegram-уведомления — только когда биржа открыта
- [x] HK акции (0700.HK) работают при закрытом рынке: `fast_info.last_price` + `history` fallback
- [x] TwelveData батч-валидация раз в 3ч (только при открытой бирже, экономия кредитов)
- [x] Автоперезапуск при падении из-за потери сети (решается `./start.sh`)

## Веб-интерфейс — Авторизация
- [x] Логин + пароль (WEB_LOGIN / WEB_PASSWORD в .env)
- [x] Сессия 30 дней, подписанный cookie (itsdangerous)
- [x] Telegram Mini App авторизация (HMAC-SHA256 initData)

## Веб-интерфейс — Дизайн
- [x] Tailwind CDN, мобильный макет max 430px
- [x] Цветовая палитра: ink/muted/faint/line/surface/accent
- [x] Нижняя панель: 2 кнопки (портфель + настройки), SPA-навигация через hx-boost
- [x] Кнопка «+» в правом верхнем углу хедера
- [x] Bottom sheet (slide-up, swайп вниз для закрытия)
- [x] Кастомное модальное окно подтверждения (без browser confirm)

## Веб-интерфейс — Список уведомлений
- [x] Карточки с текущей ценой, целью, прогресс-баром
- [x] Прогресс-бар: **зелёный** = цена должна расти, **красный** = цена должна падать
- [x] Фильтры по рынку: Все / РФ / США / Гонконг
- [x] На вкладке «Все» — плоский список (без разделения по биржам)
- [x] Сортировка (выпадающее меню): По умолчанию / Ближе к цели / Сначала новые / Сначала старые
- [x] Авто-обновление списка каждые 60 сек (HTMX)

## Веб-интерфейс — Добавление уведомлений
- [x] Поиск тикера: MOEX → TwelveData → Yahoo Finance
- [x] В карточке найденной акции — переключатель валюты (RUB / USD / HKD)
- [x] Добавление через форму с целевой ценой
- [x] Массовый импорт из Excel (.xlsx, колонка A = тикер, B = целевая цена)

## Веб-интерфейс — Настройки
- [x] Интервалы мониторинга: РФ (1/2/5 мин), США+HK (3/5/10 мин)
- [x] Выбор валюты отображения: Родная / ₽ Рубли / $ Доллары
- [x] Бюджет TwelveData (использовано / резерв / доступно)
- [x] Кнопка выхода

## Валютная конвертация
- [x] Сервис `bot/services/forex.py` — курсы через Yahoo Finance
- [x] Конвертация цен в карточках при выборе валюты в настройках
- [x] В карточке поиска — 3 кнопки: родная валюта (активна) + 2 альтернативы

## В планах / Не реализовано
- [ ] Авто-перезапуск бота при падении (systemd / supervisor)
- [ ] Push-уведомления в браузере (Web Push API)
- [ ] История срабатываний алертов
- [ ] График цены прямо в карточке (мини-чарт)
- [ ] Публичный URL (ngrok / cloudflare tunnel для доступа вне локалки)
